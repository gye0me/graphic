<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Patissier's Dream</title> 
    
    <link href="https://fonts.googleapis.com/css2?family=Gaegu&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="stylesheet" href="./style.css"> <style>
        
    </style>
</head>
<body>
    <div id="title-screen">
        <h1>Little Patissier's Dream</h1>
        <button id="start-button">게임 시작</button>
    </div>
    
    <div id="rhythm-mixer">
        <div style="color: #333; font-size: 1.1em; font-family: 'Gaegu', cursive;">믹싱! 화살표 키를 누르세요! (5초)</div>
        <div id="rhythm-progress-bar-container" style="width: 80%; height: 10px; background-color: #f8bbd0; border-radius: 5px; overflow: hidden;">
            <div id="rhythm-progress-bar" style="height: 100%; width: 100%; background-color: #d81b60;"></div>
        </div>
        <div id="rhythm-display"></div>
    </div>
    
    <div id="message">
        Little Patissier's Dream<br>케이크 제작 시뮬레이션을 시작합니다!<br>
        <span style="color: #f8bbd0;">[Spacebar]</span>를 눌러 반죽 및 믹싱 과정을 진행하세요.
    </div>

    <div id="score-overlay">
        SCORE: <span id="score-value">0</span>
        <div style="font-size: 0.6em; color: #d81b60; margin-top: 5px;">완성도</div>
        <div id="completeness-bar-container" style="width: 100px; height: 10px; background-color: #f8bbd0; border-radius: 5px; overflow: hidden; margin-top: 2px;">
            <div id="completeness-bar" style="height: 100%; width: 0%; background-color: #d81b60;"></div>
        </div>
    </div>

    <div id="palette-container">
        <div>🍰 생크림 색상 선택 (클릭 후 케이크 클릭)</div>
        <div id="cream-palette">
            <div class="palette-item selected" data-type="cream" data-color="0xffffff" style="background-color: #ffffff;">우유</div>
            <div class="palette-item" data-type="cream" data-color="0xffc0cb" style="background-color: #ffc0cb;">딸기</div>
            <div class="palette-item" data-type="cream" data-color="0x5a8d41" style="background-color: #5a8d41;">녹차</div>
            <div class="palette-item" data-type="cream" data-color="0xffd700" style="background-color: #ffd700;">고구마</div>
        </div>
        <hr style="border-color: #f8bbd0; margin: 10px 0;">
        <div>🍓 토핑 선택 (클릭 후 케이크 클릭/드래그)</div>
        <div id="topping-palette">
            <div class="palette-item" data-type="strawberry" style="background-color: #ffcccc;">딸기</div>
            <div class="palette-item" data-type="sprinkle" style="background-color: #e0e0e0;">스프링클</div>
            <div class="palette-item" data-type="drizzle" style="background-color: #a0522d;">초콜릿</div>
            <div class="palette-item" data-type="cherry" style="background-color: #ff0000; color: white;">체리</div>
            <div class="palette-item" data-type="piping" style="background-color: #ffffff; color: #333; border-color: #d81b60;">생크림</div>
        </div>
    </div>

    <div id="viewing-controls" class="controls" style="display: none;">
        <h3>🎂 관람 모드 컨트롤</h3>
        <p><span class="highlight">[P]</span> / <span class="highlight">[O]</span>: 원근 / 직교 카메라 전환</p>
        <p><span class="highlight">[↑] [↓] [←] [→]</span>: 케이크 이동</p>
        <p><span class="highlight">[1]</span> / <span class="highlight">[2]</span>: 카메라 위치 변경</p>
        <p><span class="highlight">[L]</span>: 조명 색상 변경</p>
        <p><span class="highlight">[Spacebar]</span>: 토핑 회전/정지</p>
        <p><span class="highlight">[C]</span>: 촛불 켜기/끄기</p>
        <hr style="border-color: #f8bbd0; margin: 5px 0;">
        <p><span class="highlight">[K]</span>: 케이크 전환 (제작 ↔ 테마)</p>
    </div>

<script src="./cake_app.js"></script>
<script>



// 초기 모드 설정 (타이틀 화면에서 시작)
document.addEventListener('DOMContentLoaded', () => {
    // 캔버스가 초기에는 숨겨지도록 합니다.
    renderer.domElement.style.display = 'none';
    
    const transitionModal = document.getElementById('transition-modal');
    if (transitionModal) {
        transitionModal.style.display = 'none';
    }

    // 시작 버튼 리스너 설정
    document.getElementById('start-button').addEventListener('click', () => {
        document.getElementById('title-screen').style.display = 'none'; // 타이틀 화면 숨기기
        renderer.domElement.style.display = 'block'; // 캔버스 보이기
        renderer.setAnimationLoop(animate); // 게임 시작 버튼 클릭 시 애니메이션 루프 시작
        setGameMode('MAKING'); // 게임 시작 플로우 실행
    });

    const startDecoratingButton = document.getElementById('start-decorating-button');
    if (startDecoratingButton) {
        startDecoratingButton.addEventListener('click', () => {
            document.getElementById('transition-modal').style.display = 'none';
            // Manually set the step to 4 (Baking Complete state) and advance to 5 (DECORATING)
            if (typeof makingStep !== 'undefined' && makingStep === 4) {
                advanceMakingStep(); 
            }
        });
    }
});
</script>

<div id="transition-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 300; display: flex; justify-content: center; align-items: center;">
    <div style="background: white; padding: 40px; border-radius: 15px; text-align: center; border: 5px solid #d81b60; box-shadow: 0 0 30px #f8bbd0; font-family: 'Gaegu', cursive;">
        <h2 style="color: #d81b60; font-size: 2em; margin-bottom: 20px;">다음 단계로 넘어갈까요?</h2>
        <p style="color: #333; margin-bottom: 30px; font-size: 1.2em;">케이크가 맛있게 구워졌습니다! 이제 생일 케이크를 장식할 시간이에요.</p>
        <button id="start-decorating-button" style="padding: 10px 25px; font-size: 1.5em; font-family: 'Gaegu', cursive; border: 3px solid #3de6c5; background-color: #fce4ec; color: #d81b60; cursor: pointer; border-radius: 8px;">
            🎂 장식 모드 시작!
        </button>
    </div>
</div>

</body>
</html>